# RVC WAV変換サーバー

このプロジェクトは、RVCモデルを使用してWAVファイルの音声変換を行うDockerコンテナを提供します。

## 機能

- WAVファイルをアップロードして、RVCモデルを使用して音声変換
- 音程変更（ピッチシフト）
- インデックス比率調整
- 保護率調整
- 変換済みWAVファイルのダウンロード

## 必要条件

- Docker
- model_dirディレクトリにRVCモデル（.pthファイルと.indexファイル）を配置

## セットアップと実行方法

### 1. RVCモデルの配置

`model_dir/2/`ディレクトリに以下のファイルを配置します：

- `tire.pth`（または任意の名前のRVCモデルファイル）
- `tire.index`（またはモデルに対応するインデックスファイル）
- `params.json`（モデルパラメータファイル）

### 2. Dockerコンテナのビルドと実行

以下のスクリプトを実行してDockerコンテナをビルドし、サーバーを起動します：

```bash
./build_run_mmvc_wav_converter.sh
```

サーバーは http://localhost:18888 で起動します。

### 3. クライアントからの利用

#### HTML UIを使用する場合

1. `rvc_wav_converter_client.html`をWebブラウザで開きます
2. WAVファイルを選択します
3. 必要に応じて音程変更、インデックス比率、保護率を調整します
4. 「変換開始」ボタンをクリックします
5. 変換完了後、結果の音声を再生したりダウンロードしたりできます

#### API直接利用

以下のエンドポイントが利用可能です：

- `GET /`: APIのヘルプメッセージを取得
- `GET /convert_model_info`: 利用可能なモデル情報を取得
- `POST /convert_wav_file`: WAVファイル変換（multipart/form-data形式）
  - パラメータ:
    - `file`: WAVファイル
    - `output_filename`: 出力ファイル名（オプション）
    - `f0_up_key`: 音程変更 -12〜12（オプション、デフォルト: 0）
    - `index_ratio`: インデックス比率 0〜1（オプション、デフォルト: 0）
    - `protect`: 保護率 0〜1（オプション、デフォルト: 0.5）

## トラブルシューティング

### モデルが正しくロードされない場合

1. `model_dir/2/params.json`ファイルの内容が正しいか確認してください
2. RVCモデルファイル（.pthファイル）とインデックスファイル（.indexファイル）が`model_dir/2/`ディレクトリに存在するか確認してください
3. Dockerコンテナのログで詳細なエラーメッセージを確認してください

### 音声変換が機能しない場合

1. WAVファイルのサンプリングレートがモデルでサポートされているか確認してください（通常44.1kHzか48kHz）
2. WAVファイルがモノラルであることを確認してください（ステレオの場合は変換前にモノラルに変換してください）
3. ファイルサイズが大きすぎないか確認してください（大きなファイルは処理に時間がかかります）

## カスタマイズ

### 異なるRVCモデルを使用する場合

1. 新しいRVCモデルを`model_dir/2/`ディレクトリに配置します
2. `params.json`ファイルを更新して、新しいモデルのファイル名と設定を反映させます
3. Dockerコンテナを再起動します

### ポート番号を変更する場合

`docker/exec-mmvc-wav.sh`ファイルを編集してポート番号を変更し、Dockerコンテナをリビルドします。

## 制限事項

- 現在のバージョンではCPUモードでのみ動作します
- メモリ使用量が多いため、大きなモデルや長いWAVファイルの処理は注意が必要です
- モデルのロードには時間がかかることがあります
- クロスオリジンリソース共有（CORS）の制限により、異なるドメインからのAPIアクセスが制限される場合があります 